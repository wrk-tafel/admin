<c-row>
  <c-col>
    <c-card>
      <c-card-body>
        <c-row>
          <c-col class="mb-2">
            <h4>Kunden-Annahme</h4>
          </c-col>
        </c-row>
        <c-row>
          <c-col sm="3" class="align-self-center">
            <label class="form-label">Scanner</label>
          </c-col>
          <c-col sm="3" class="align-self-center">
            <select testid="scannerIdInput" class="form-control" cSelect [(ngModel)]="selectedScannerId">
              <option [ngValue]="undefined">Nicht aktiv</option>
              <option *ngFor="let scannerId of scannerIds" [ngValue]="scannerId">Nr. {{scannerId}}</option>
            </select>
          </c-col>
          <c-col>
            <h5>
              <c-badge [color]="scannerReadyStateColor" testid="state-server" class="mt-3 mt-md-0 mt-lg-0">
                {{scannerReadyState ? 'AKTIV' : 'INAKTIV'}}
              </c-badge>
            </h5>
          </c-col>
        </c-row>
        <hr>
        <c-row>
          <c-col sm="3">
            <label class="form-label">Kundennummer</label>
          </c-col>
          <c-col sm="3" class="mb-3">
            <input testid="customerIdInput" #customerIdInput type="number" name="customerIdInput" [(ngModel)]="customerId"
                   class="form-control" (keydown.enter)="searchForCustomerId()">
          </c-col>
          <c-col sm="3">
            <button testid="showCustomerButton" cButton color="primary" class="text-white"
                    [disabled]="!customerId" (click)="searchForCustomerId()">Anzeigen
            </button>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
    <c-card class="mt-3" *ngIf="customer !== undefined" testid="customerDetailPanel">
      <c-card-body>
        <c-row>
          <c-col class="mb-2">
            <h4>
              <c-badge [color]="getCustomerStateColor()">
                {{customerStateText}}
              </c-badge>
              {{customer.id}} - {{customer.lastname}} {{customer.firstname}}
            </h4>
          </c-col>
        </c-row>
        <c-row>
          <c-col>Gültig bis:</c-col>
          <c-col>{{customer.validUntil | date : 'dd.MM.yyyy'}}</c-col>
        </c-row>
        <hr>
        <c-row>
          <c-col>Adresse:</c-col>
          <c-col>{{formatAddress()}}</c-col>
        </c-row>
        <c-row>
          <c-col>Personen im Haushalt (insgesamt):</c-col>
          <c-col>{{customer.additionalPersons.length + 1}}</c-col>
        </c-row>
        <c-row>
          <c-col>Personen unter 3 Jahren:</c-col>
          <c-col>{{getInfantCount()}}</c-col>
        </c-row>
        <hr>
        <c-row>
          <c-col>
            <c-card>
              <c-card-header class="fw-bold">Aktuellste Notiz</c-card-header>
              <c-card-body>
                <div class="fw-bold" *ngIf="customerNotes?.length === 0">
                  <h6 testid="nonotes-label">Keine Notiz vorhanden</h6>
                </div>
                <div *ngIf="customerNotes && customerNotes?.length !== 0">
                  <div class="row mb-2">
                    <div class="col fw-bold" testid="note-title">{{customerNotes[0].timestamp | date : 'dd.MM.yyyy HH:mm' }}&nbsp;{{customerNotes[0].author}}</div>
                  </div>
                  <div class="row">
                    <div class="col" testid="note-text" [innerHtml]="customerNotes[0].note"></div>
                  </div>
                </div>
              </c-card-body>
            </c-card>
          </c-col>
        </c-row>
        <c-row>
          <c-col>
            <div *ngIf="customerState !== 0">
              <hr>
              <c-row>
                <c-col size="12" md="2" class="fw-bold">Ticket-Nummer: *</c-col>
                <c-col size="12" md="2" class="align-middle">
                  <input testid="ticketNumberInput" #ticketNumberInput type="number" name="ticketNumberInput" [(ngModel)]="ticketNumber"
                         class="form-control" required (keydown.enter)="assignCustomer()"
                         [ngClass]="{'is-invalid': !ticketNumber, 'is-valid': ticketNumber}">
                </c-col>
                <c-col>
                  <button testid="deleteTicketButton" *ngIf="ticketNumberEdit === true" class="btn btn-danger text-white ms-0 ms-md-3 mt-3 mt-md-0" (click)="deleteTicket()">Ticket löschen</button>
                </c-col>
              </c-row>
            </div>
          </c-col>
        </c-row>
      </c-card-body>
      <c-card-footer>
        <c-row>
          <c-col>
            <button [disabled]="customerState === 0 || !ticketNumber" testid="assignCustomerButton" class="btn btn-success text-white" (click)="assignCustomer()">Annehmen</button>
            <button testid="cancelButton" #cancelButton class="btn btn-primary text-white ms-3" (click)="cancel()">Abbrechen</button>
          </c-col>
        </c-row>
      </c-card-footer>
    </c-card>
  </c-col>
</c-row>
